// Generated by CoffeeScript 1.3.3
(function() {
  var $, convert_actual_to_friendly, convert_input_to_actual, defaults, get_value_field, update_value_field, value_field_selector;

  $ = jQuery;

  value_field_selector = "[data-money-field]";

  defaults = {
    prefix: '$'
  };

  $.fn.extend({
    moneyfield: function(params) {
      var opt;
      opt = $.extend(defaults, params);
      return this.each(function() {
        var $val, cursor_pos;
        if ($(this).data('money-field')) {
          return this;
        }
        $(this).data('money-field', opt);
        $(this).keyup(update_value_field);
        cursor_pos = $(this).caret().start;
        $val = get_value_field.call(this);
        $(this).val(convert_actual_to_friendly.call($val, opt.prefix));
        $(this).caret(cursor_pos, cursor_pos);
        return this;
      });
    }
  });

  get_value_field = function() {
    return $(this).parent().find(value_field_selector);
  };

  convert_input_to_actual = function(prefix) {
    return $(this).val().replace(/\./g, "").replace(prefix, "");
  };

  convert_actual_to_friendly = function(prefix) {
    var dollars;
    dollars = $(this).val() / 100;
    return "" + prefix + (dollars.toFixed(2));
  };

  update_value_field = function() {
    var $val, cursor_pos, prefix;
    cursor_pos = $(this).caret().start;
    prefix = $(this).data('money-field').prefix;
    $val = get_value_field.call(this);
    $val.val(convert_input_to_actual.call(this, prefix));
    $(this).val(convert_actual_to_friendly.call($val, prefix));
    return $(this).caret(cursor_pos, cursor_pos);
  };

}).call(this);
